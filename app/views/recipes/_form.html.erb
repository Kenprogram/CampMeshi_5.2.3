<div class="container"> 
  <%= form_with(model: recipe, local: true) do |form| %>
    <% if recipe.errors.any? %>
      <div id="error_explanation">
        <h2><%= pluralize(recipe.errors.count, "error") %> prohibited this recipe from being saved:</h2>

        <ul>
          <% recipe.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <div class="form-group">
      <%= form.label :title, "タイトル" %>
      <%= form.text_field :title,  class: "form-control", placeholder: "タイトルを入力してください" %>
    </div>

    <label for="file_photo" class="rounded-circle userProfileImg">
      <div class="userProfileImg_description">画像をアップロード</div>
      <i class="fas fa-camera fa-3x"></i>
      <%= form.file_field :img_name_recipe, id: "file_photo" %>
    </label>
    <div class="userImgPreview" id="userImgPreview">
      <img id="thumbnail" class="userImgPreview_content" accept="image/*" src="">
      <p class="userImgPreview_text">画像をアップロード済み</p>
    </div>

    <div class="form-group">
      <%= form.label :category, "カテゴリー" %>
      <%= form.select :category, Recipe.categories.keys, {}, { class: "form-control" } %>
    </div>

    <div class="form-group">
      <%= form.label :materials, "材料・分量" %>
      <%= form.fields_for :materials do |material| %> 
        <%= render 'material_fields', f: material %> 
      <% end %>
      <div class="links">
        <%= link_to_add_association "材料・分量を追加", form, :materials  %>
      </div> 
    </div>

    <div class="form-group">
      <%= form.label :how_tos, "作り方" %>
      <%= form.fields_for :how_tos do |howto| %> 
        <%= render 'how_to_fields', f: howto %> 
      <% end %>
      <div class="links">
        <%= link_to_add_association "作り方の追加", form, :how_tos  %>
      </div> 
    </div>

    <div class="actions">
      <%= form.submit "レシピを投稿する", class: "btn submitBtn" %>
    </div>
  <% end %>

  <% content_for :javascript do %>
    <script>
      :javascript
        $(function() {
          $('#websites a.remove_fields').hide();

          $('#websites').on('cocoon:after-insert', function() {
            check_content();
          });
          
          $('#websites').on('cocoon:after-remove', function() {
            check_content();
          });
          
          function check_content() {
            if($('#websites .nested-fields').length == 10) {
              $('#websites a.add_fields').hide();
            } else {
              $('#websites a.add_fields').show();
            }
          }
        });
    </script>
  <% end %>

</div>